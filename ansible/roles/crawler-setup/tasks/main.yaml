---
# Create Docker config directory
- name: Make sure that Docker config directory exists
  become: yes
  file:
    path: "~/.docker"
    state: "directory"

# Set Docker proxy for University of Melbourne Research Cloud
# - name: Ensure Docker client proxy settings are present on the server
#   become: yes
#   copy:
#     content: "{{ docker_proxy_settings }}"
#     dest: ~/.docker/config.json

# Build Docker image for crawler
- name: Build an image and push it to local repo
  docker_image:
    build:
      path: "/home/ubuntu/COMP90024/ccc-p2/crawler"
      pull: yes
    name: ccc-p2/crawler
    tag: latest
    source: build
    force: yes
  become: yes
  environment: "{{ proxy_env }}"
# # Stop existing Docker containers for Twitter Harvesters and remove them (if any)
# - name: Stop Twitter Harvester Docker container
#   become: yes
#   docker_container:
#     name: twitter-harvester
#     state: absent

# # Install cloudant python package to reset Twitter Harvester configuration in CouchDB
# - pip:
#     name: cloudant
#   become: true
#   environment: "{{ proxy_env }}"

# # Run script to reset Twitter Harvester configuration in CouchDB
# - name: Reset twitter harvesters
#   command: 'python3 ~/cluster-and-cloud-computing-assignment-2/twitter-harvester/reset_twitter_harvesters.py'
#   become: true
#   run_once: true

# # Create new docker container for Crawler and start container
# - name: Create and start crawler Docker container
#   become: yes
#   docker_container:
#     name: twitter-harvester
#     image: cloud-assignment-2/tweet-harvester
#     state: started
#     pull: false
#     recreate: true
